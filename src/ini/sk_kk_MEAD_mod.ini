[runtime]
; sampler = emcee
;sampler = multinest
sampler = test
root = ${COSMOSIS_SRC_DIR}

[DEFAULT]
2PT_FILE = ${COSMOSIS_SRC_DIR}/ACTxDESY3/src/data/2pt_NG_desy1.fits


[emcee]
burn=0.3
walkers = 256
samples = 100000
nsteps = 1


[output]
filename= ${COSMOSIS_SRC_DIR}/ACTxDESY3/src/chains/chain_sz_actxdesy3.txt
format=text
lock=F



[test]
save_dir=${COSMOSIS_SRC_DIR}/output_MEAD_wb/

[pipeline]
quiet=T
timing=T
debug=F
priors = ${COSMOSIS_SRC_DIR}/ACTxDESY3/src/values/priors_sz_kk_MEAD.ini
modules = consistency camb mead  extrapolate load_nz_sources load_nz_lens lens_photoz_bias source_photoz_bias unbiased_galaxies bias_neutrinos  multiply_pk IA ia_z_field pk_to_cl bin_bias add_intrinsic shear_m_bias 2pt_gal_fullsky 2pt_gal_shear 2pt_shear
;pk_to_cl 
; extrapolate fits_nz_lens fits_nz_source lens_photoz_bias
values = ${COSMOSIS_SRC_DIR}/ACTxDESY3/src/values/values_sz_kk_MEAD.ini
likelihoods = 
extra_output = cosmological_parameters/sigma_8

[load_nz_sources]
file = ${COSMOSIS_SRC_DIR}/cosmosis-standard-library/number_density/load_nz_fits/load_nz_fits.py
nz_file = ${COSMOSIS_SRC_DIR}/ACTxDESY3/src/data/source1.fits
data_sets = nz_source
prefix_section = F
prefix_extension = F

[load_nz_lens]
file = ${COSMOSIS_SRC_DIR}/cosmosis-standard-library/number_density/load_nz_fits/load_nz_fits.py
nz_file = ${COSMOSIS_SRC_DIR}/ACTxDESY3/src/data/nz_y3_redmagic_v6.4.22_v2_gold_2.2.1_combined_max_bin_edges.fits 
data_sets = lens
prefix_section = T
prefix_extension = T


[consistency]
file = cosmosis-standard-library/utility/consistency/consistency_interface.py

[camb]
file = cosmosis-standard-library/boltzmann/camb/camb.so
mode=all
lmax=2500
feedback=0
kmin=1e-5
kmax=10.0
nk=400

[mead]
;file = cosmosis-standard-library/structure/mead_mod/mead_interface.so
file = ${COSMOSIS_SRC_DIR}/ACTxDESY3/src/cosmosis_code/mead_mod/mead_interface_mod.so
nk = 200
kmin=1e-5
kmax=10.0
zmin = 0.0
zmax = 4.0
nz = 101




[camb]
file = cosmosis-standard-library/boltzmann/camb/camb.so
mode=all
lmax=2500
feedback=0
kmin=1e-5
kmax=10.0
nk=200
zmax = 4.0
nz = 101



[extrapolate]
file = cosmosis-standard-library/boltzmann/extrapolate/extrapolate_power.py
kmax = 500.



#the two modules below might be replaced in the future by a different parametrization
[lens_photoz_bias]
file = cosmosis-standard-library/number_density/photoz_bias/photoz_bias.py
mode = additive
sample = nz_lens
bias_section = lens_photoz_errors
interpolation = linear

[source_photoz_bias]
file = cosmosis-standard-library/number_density/photoz_bias/photoz_bias.py
mode = additive
sample = nz_source
bias_section = wl_photoz_errors
interpolation = linear

[unbiased_galaxies]
file = cosmosis-standard-library/bias/no_bias/no_bias.py
use_lin_power = False

[bias_neutrinos]
file = cosmosis-des-library/lss/braganca-neutrino-bias/interface.so
feedback = true
linear_growth_eps_abs = 0.0
linear_growth_eps_rel = 1.0e-6
linear_growth_rk_type = RK45
linear_growth_spline_zmin = 0.0
linear_growth_spline_zmax = 1.00
linear_growth_spline_delta_z = 0.02

[multiply_pk]
file = cosmosis-des-library/lss/braganca-neutrino-bias/bias_pks.py

[IA]
#linear_alignments_interface.py
file=cosmosis-standard-library/intrinsic_alignments/la_model/linear_alignments_interface.py
method=bk_corrected
do_galaxy_intrinsic=T

[ia_z_field]
file = ${COSMOSIS_SRC_DIR}/cosmosis-standard-library/intrinsic_alignments/z_powerlaw/ia_z_powerlaw.py
do_galaxy_intrinsic = T


[pk_to_cl]
file = cosmosis-standard-library/structure/projection/project_2d.py
ell_min = 0.1
ell_max = 5.0e5
n_ell = 400
shear-shear = source-source
shear-intrinsic = source-source
intrinsic-intrinsic = source-source
position-shear = lens-source
position-intrinsic = lens-source
position-position = lens-lens
verbose = F
get_kernel_peaks = F

#faster version of pk_to_cl below:
#(it probably won't work with TATT, so I'll leave it commented)
#[pk_to_cl]
#file = cosmosis-standard-library/structure/projection/project_2d.py
#ell_min = 0.1
#ell_max = 5.0e5
#n_ell = 400
##shear-shear = source-source
#fast-shear-shear-ia = source-source
##fast-position-shear-ia = lens-source
##position-position = lens-lens
#verbose = F
#get_kernel_peaks = F

[bin_bias]
file = cosmosis-standard-library/bias/binwise_bias/bin_bias.py
perbin = T
apply_to_cl = T 

[add_intrinsic]
file=cosmosis-standard-library/shear/add_intrinsic/add_intrinsic.py
shear-shear=T
position-shear=T
perbin=F

[shear_m_bias]
file = cosmosis-standard-library/shear/shear_bias/shear_m_bias.py
m_per_bin = True
verbose = F

[2pt_gal]
file = cosmosis-standard-library/shear/cl_to_xi_nicaea/nicaea_interface.so
corr_type = 1

[2pt_gal_fullsky]
file = cosmosis-standard-library/shear/cl_to_xi_fullsky/cl_to_xi_interface.py
corr_type = 2
ell_max = 40000
xi_type='00'
n_theta=50

[2pt_gal_shear]
file = cosmosis-standard-library/shear/cl_to_xi_nicaea/nicaea_interface.so
corr_type = 2

[2pt_shear]
file = cosmosis-standard-library/shear/cl_to_xi_nicaea/nicaea_interface.so
corr_type = 0